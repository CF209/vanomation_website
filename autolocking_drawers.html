<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Auto-Locking Drawers</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Squadfree - v4.6.0
  * Template URL: https://bootstrapmade.com/squadfree-free-bootstrap-template-creative/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top ">
    <div class="container d-flex align-items-center justify-content-between">

      <div class="logo">
        <h1 class="text-light"><a href="index.html"><span>Vanomation</span></a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="index.html#hero">Home</a></li>
          <li><a class="nav-link scrollto" href="index.html#about">About</a></li>
          <li><a class="nav-link scrollto" href="index.html#pictures">Pictures</a></li>
          <li class="dropdown"><a href="#"><span>Tutorials</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="setting_up_raspberry_pi.html">Setting up the Raspberry Pi</a></li>
              <li><a href="installing_home_assistant.html">Installing Home Assistant</a></li>
              <li><a href="control_the_lights.html">Controlling the Lights</a></li>
              <li><a href="add_wireless_switches.html">Adding Wireless Switches</a></li>
              <li><a href="monitor_solar_power.html">Monitoring Solar Power</a></li>
              <li><a href="monitor_water_level.html">Monitoring Water Level</a></li>
              <li><a href="monitor_propane_level.html">Monitoring Propane Level</a></li>
              <li><a href="adding_van_tilt_sensor.html">Adding a Van Tilt Sensor</a></li>
              <li><a href="autolocking_drawers.html">Auto-Locking Drawers</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="future_projects.html">Future Projects</a></li>
         <!-- <li><a class="nav-link scrollto" href="#contact">Contact</a></li> -->
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs Section ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Auto-Locking Drawers</h2>
          <ol>
            <li><a href="index.html">Home</a></li>
            <li>Auto-Locking Drawers</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs Section -->

    <section class="tutorial_imgs">
      <div class="row">
        <div class="portfolio-details-slider swiper">
          <div class="swiper-wrapper align-items-center">

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer1.jpg" class="tut_swiper_img" alt="">
            </div>

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer2.png" class="tut_swiper_img" alt="">
            </div>

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer3.jpeg" class="tut_swiper_img" alt="">
            </div>

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer4.png" class="tut_swiper_img" alt="">
            </div>

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer5.png" class="tut_swiper_img" alt="">
            </div>

            <div class="swiper-slide">
              <img src="assets/img/drawer/drawer6.png" class="tut_swiper_img" alt="">
            </div>

          </div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </section>

    <section class="inner-page">
      <div class="container">
        <div>&nbsp;One of the biggest issues I've had with my van build has been with the drawers. They seem to
          always want to fly open while driving. I started off using a mix of magnetic and physical door catches, but they
          were either too weak for the heavier drawers, or wouldn't always latch properly. Next I added physical latches to
          the heavier drawers, but they would either vibrate open on bumpy roads, or I'd simply forget to latch them before
          driving. Then one day I came across a solenoid door latch. It seemed like the perfect solution! I could integrate
          it into my Home Assistant set up and program it to automatically lock closed.</div>
        <div><br /></div>
        <div>Items needed to set this up:</div>
        <div class="amazon">
          <ul>
            <li><b><a href="https://www.amazon.com/gp/product/B07TJN2XNN/" target="_blank">Solenoid
                  Door Latch</a>:</b>&nbsp;This is the only one I found that fit my needs. It
                needed to run on 12V, be unlocked when not powered, have a door style latch (not just a cylinder), and be
                relatively low power</li>
            <li><b>Other electronics:&nbsp;</b>Either an ESP32/ESP8266 or use the Raspberry Pi to
              control the solenoid, plus a MOSFET, diode, and resistor (see below for details on the circuit)</li>
          </ul>
        </div>
        <div>&nbsp;A solenoid is a device that converts an electrical current into linear motion. The device generally
          consists of wire coil with a plunger in the middle of it. When current is passed through the coil, it generates a
          magnetic field which pushes the plunger in one direction. When the current is removed, a mechanical spring pulls
          the plunger back to its starting position.</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer1.jpg">
        </div>
        <div><br /></div>
        <div>&nbsp;In the above solenoid that I selected, the plunger has a door style latch on its end. The solenoid also
          runs on 12V which fits into the van electrical system well. It's relatively low power 0.3A when powered, although
          power isn't a big deal since I plan to only power it when the engine is running and the alternator is charging my
          batteries. The above solenoid is also unlocked when it's not powered which is very important for my application.
          Most of the devices I found were actually the opposite.</div>
        <div><br /></div>
        <div>&nbsp;With the solenoid selected, we now need a way to switch it on and off. The circuit used for this is very
          similar to the circuit used to control the lights:</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer2.png">
        </div>
        <div>&nbsp;A GPIO pin from an ESP32 is used to power on and off an N-Channel
          MOSFET. This shuts on and off the current flowing through the solenoid which is connected to J5. A 10k pull-down
          resistor is added to the GPIO pin so that when the GPIO pin is not configured, the solenoid will be powered off. A
          diode is also connected in reverse across the solenoid. This is done because the solenoid is essentially an
          inductor. Inductors cannot change current instantaneously, so when the MOSFET is switched off, current will
          continue flowing through the solenoid for a short period. With nowhere for the current to go, a voltage spike can
          occur. The added diode gives the current a return path once the voltage increases past the diodes forward voltage
          value and prevents it from spiking any higher.</div>
        <div><br /></div>
        <div>&nbsp;With the circuit built on a breadboard and using an ESP32 development board (I plan to design another PCB
          for this eventually), I rigged up a latch on one of my most problematic drawers:</div>
        <div><br /></div>
        <div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer3.jpeg">
        </div>
        <div><br /></div>
        <div>The ESPHome code was pretty straightforward for this one. Just a simple output switch:</div>
        <div class="terminal">
            switch:<br>
            &emsp; - platform: gpio<br>
            &emsp;&emsp;&emsp; pin: 26<br>
            &emsp;&emsp;&emsp; name: "Solenoid"<br>
        </div>
        <div>With the ESP32 programmed, I could now control the solenoid from Home Assistant!</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer4.png">
        </div>
        <div><br /></div>
        <div>&nbsp;This solved the first part of the problem, but I still wanted to have the drawer automatically lock
          when I'm driving. Some different solutions I was thinking of for this included using the accelerometer from the
          van tilt sensor to detect motion, or connecting to a bluetooth OBD2 adapter and reading the speed of the van.
          Then I remembered that I had tapped into one of the ignition wires in the van for the DC-DC charger to charge my
          batteries from the alternator when the engine is running. If I could also detect this signal on the Raspberry
          Pi, I could lock the drawer when the engine is running.</div>
        <div><br /></div>
        <div>&nbsp;I'm not an expert on how the ignition wires work, but my guess was that there's a voltage when the van
          is on, and it's grounded when the van is off. My multimeter unfortunately broke, so I wasn't able to double
          check this, but I continued with this assumption anyways. I assume the voltage on this signal would be too high
          for the Raspberry Pi GPIO pins, so I used a MOSFET to step down the voltage:</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer5.png">
        </div>
        <div>&nbsp;This circuit steps down the voltage so the Raspberry Pi GPIO pin won't see more than 3.3V. It also
          inverts the signal so it should read '1' when the van is off and '0' when it is on. Note that if you don't have
          a common ground between your house batteries and the van battery this circuit could perform in unexpected ways.
        </div>
        <div><br /></div>
        <div>&nbsp;Next I had to add this signal into Home Assistant. This is done by adding a binary sensor to the
          configurations.yaml file:</div>
        <div class="terminal">
            binary_sensor:<br>
            &emsp; - platform: rpi_gpio<br>
            &emsp;&emsp;&emsp; ports:<br>
            &emsp;&emsp;&emsp;&emsp;&emsp; 26: Van Ignition<br>
            &emsp;&emsp;&emsp; invert_logic: true          
        </div>
        <div>&nbsp;This sets up the sensor on GPIO pin 26 on the Raspberry Pi and re-inverts it. After restarting Home
          Assistant you should now have this sensor in your setup.</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer6.png">
        </div>
        <div><br /></div>
        <div>&nbsp;The last step is to create automations for locking and unlocking the drawer. You can create the 
          automations in GUI by going to Configuration -&gt; Automations. The trigger should look like this:</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer7.png">
        </div>
        <div><br /></div>
        <div>&nbsp;And the action should look like this:</div>
        <div><br /></div>
        <div class="tut_img">
          <img src="assets/img/drawer/drawer8.png">
        </div>
        <div><br /></div>
        <div>&nbsp;With the automations set up, Home Assistant should now automatically lock the drawer when the van is
          started and unlock it when it's turned off. I can hear the satisfying click of the solenoid every time I turn on
          the van letting me know the drawer is locked!</div>
        <div><br /></div>
        <div class="next_link">
          <a href="future_projects.html">Next: Future Projects</a>
        </div>
        <div><br /></div>
      </div>
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="footer-top">
      <div class="container">
        <div class="row">
          <p style="text-align: center">
            See more at <a href="https://github.com/CF209">https://github.com/CF209</a>
          </p>

        </div>
      </div>
    </div>

    <div class="container">
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/squadfree-free-bootstrap-template-creative/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>